import matplotlib.pyplot as plt

fig_path='vis/result/quant/250311_results.png'

qeft_7b_w2 = [8.939564705, 7.66188097, 7.362611294, 6.960505486, 6.509650707, 6.140522003, 6.05310154, 5.974632263, 5.8235569, 5.790556431, 5.747614384, 5.684456348, 5.604714394]
qeft_7b_c4 = [11.04658794, 9.724061966, 9.366743088, 9.000476837, 8.390424728, 8.039003372, 7.939477444, 7.833660603, 7.674541473, 7.600475788, 7.562263012, 7.47279501, 7.420116425]
qeft_7b_acc = [0.618145594, 0.640913137, 0.653708471, 0.66536979, 0.672768044, 0.681075178, 0.675960343, 0.690921688, 0.687990102, 0.689710297, 0.689534347, 0.695047911, 0.693481488]
qeft_7b_bits = [2.20390043, 2.40458655, 2.50482462, 2.60080984, 2.80457365, 2.99569022, 3.10413926, 3.20332613, 3.403801, 3.50056418, 3.60497667, 3.80254969, 4.00467156]

awq_7b_w2 = [9.70293808, 9.225644112, 8.307990074, 7.857845783, 7.460319519, 6.853315353, 6.713390827, 6.187410831, 6.080403805, 6.020772934, 5.983048916, 5.869136333, 5.8397789, 5.793658257, 5.705946922, 5.68144989, 5.597347736]
awq_7b_c4 = [12.82921791, 12.24621773, 10.93458462, 10.40924454, 9.837593079, 9.070055962, 8.866043091, 8.225736618, 8.101255417, 8.009811401, 7.973155499, 7.793493271, 7.715877056, 7.64744854, 7.556500912, 7.530736923, 7.44137764]
awq_7b_acc = [0.604282098, 0.610942152, 0.625704665, 0.636528213, 0.637907708, 0.662299114, 0.666701336, 0.677821555, 0.680930553, 0.682099624, 0.684146233, 0.686616407, 0.685500533, 0.686102525, 0.690475559, 0.688649375, 0.697427872]
awq_7b_bits = [2.20369171, 2.254047927, 2.40349741, 2.50259067, 2.60427461, 2.75372409, 2.80246114, 2.99740933, 3.10249352, 3.20498705, 3.25194301, 3.40123057, 3.50291451, 3.60103627, 3.75275259, 3.80310881, 3.99222798]

qeft_13b_w2 = [7.312336922, 6.44382143, 6.211709499, 5.956926346, 5.707955837, 5.60380125, 5.356990814, 5.280495644, 5.23458004, 5.173476696, 5.11740303, 5.079916477, 5.033089638, 5.02025938, 4.973930836]
qeft_13b_c4 = [9.644190788, 8.648790359, 8.319005013, 8.053458214, 7.68607378, 7.549599171, 7.263856411, 7.197036266, 7.126281738, 7.02818203, 6.976723194, 6.938338757, 6.884701729, 6.872583389, 6.829242229]
qeft_13b_acc = [0.662555056, 0.686991207, 0.691609208, 0.699973681, 0.712075573, 0.709898887, 0.716360031, 0.71971652, 0.720285046, 0.725598155, 0.723079703, 0.722883171, 0.728539927, 0.729197004, 0.729530597]
qeft_13b_bits = [2.20435563, 2.40246772, 2.50428461, 2.6045984, 2.75422521, 2.80328771, 3.00389205, 3.09704158, 3.20422779, 3.40286803, 3.50465909, 3.6035266, 3.75150956, 3.79901214, 4.00323864]

awq_13b_w2 = [7.209764004, 6.441867828, 6.211341858, 5.988779068, 5.742465019, 5.634430885, 5.374492168, 5.304297924, 5.24823761, 5.228238106, 5.157777786, 5.128776073, 5.090263367, 5.030594826, 5.024534225, 4.965404987]
awq_13b_c4 = [9.835852623, 8.829443932, 8.517198563, 8.194261551, 7.803359032, 7.670791626, 7.335062981, 7.241182327, 7.170888901, 7.136387348, 7.054496765, 7.015735626, 6.962110519, 6.897399902, 6.886018276, 6.837729931]
awq_13b_acc = [0.66219152, 0.682863029, 0.689958569, 0.691083918, 0.703693136, 0.710422927, 0.715917286, 0.718818017, 0.71687743, 0.72231014, 0.725760049, 0.724154011, 0.722983757, 0.728700119, 0.727874139, 0.728116507]
awq_13b_bits = [2.20309917, 2.40061983, 2.50433884, 2.60392562, 2.74938017, 2.80206612, 3.00165289, 3.10371901, 3.20392562, 3.25454545, 3.40123967, 3.50061983, 3.60392562, 3.75475207, 3.80041322, 3.98615702]

qeft_70b_w2 = [5.317243099, 5.039577484, 4.618614674, 4.423460484, 4.255228043, 4.012526512, 3.939234257, 3.743244648, 3.682305574, 3.634720087, 3.551562071, 3.522059202, 3.493807793, 3.458101749, 3.443671465, 3.410834074]
qeft_70b_c4 = [7.563521862, 7.271322727, 6.804297447, 6.614375591, 6.455762386, 6.236303329, 6.167287827, 6.008308411, 5.958526611, 5.924927235, 5.871528149, 5.841858387, 5.821423054, 5.795339108, 5.785583019, 5.76804924]
qeft_70b_acc = [0.732253275, 0.739255969, 0.753903816, 0.75489282, 0.758559056, 0.763819915, 0.766156762, 0.769672578, 0.769757006, 0.77108139, 0.774220332, 0.772095662, 0.773855682, 0.773979619, 0.775748709, 0.772987617]
qeft_70b_bits = [2.10389237, 2.20497855, 2.40263624, 2.50440123, 2.60448405, 2.75136767, 2.80499866, 2.99839681, 3.10188419, 3.20458601, 3.39742934, 3.50144139, 3.60226237, 3.75436437, 3.80433517, 3.9954159]

awq_70b_w2 = [5.175560951, 4.993602276, 4.893946171, 4.576478481, 4.422606468, 4.275177956, 4.034964085, 3.963034868, 3.724072933, 3.667384624, 3.627696037, 3.605181217, 3.550760746, 3.52549696, 3.496205807, 3.456231833, 3.445744038, 3.410032511]
awq_70b_c4 = [7.627700806, 7.389309883, 7.246460438, 6.886165619, 6.714670658, 6.535670757, 6.30312109, 6.232421398, 6.018145561, 5.971095562, 5.942317963, 5.922836781, 5.87950182, 5.860199928, 5.835152149, 5.808598518, 5.799371719, 5.773358345]
awq_70b_acc = [0.737667448, 0.738021299, 0.744922683, 0.743657972, 0.753498046, 0.755443093, 0.762817355, 0.76499475, 0.766131804, 0.76751751, 0.769627149, 0.769929044, 0.768681573, 0.771572233, 0.772659542, 0.772436607, 0.773729407, 0.776231165]
awq_70b_bits = [2.104411765, 2.20306373, 2.25281863, 2.40490196, 2.50367647, 2.60294118, 2.753063725, 2.80416667, 3.00343137, 3.10355392, 3.20294118, 3.25036765, 3.40490196, 3.49852941, 3.60465686, 3.74840686, 3.79730392, 3.987377451]

fig, axes = plt.subplots(nrows=3, ncols=3, figsize=(15, 15)) 
fig.subplots_adjust(hspace=0.5, wspace=0.1)

axes[0, 0].plot(awq_7b_bits, awq_7b_w2, label='awq')
axes[0, 0].plot(qeft_7b_bits, qeft_7b_w2, label='qeft')
axes[0, 0].set_title('Llama 2 7B Wikitext')
axes[0, 0].set_xlabel('Bits')
axes[0, 0].set_ylabel('Perplexity')
axes[0, 0].grid(c='0.8')
axes[0, 0].legend(loc='upper right')
# axes[0, 0].set_yscale('log')

axes[0, 1].plot(awq_7b_bits, awq_7b_c4, label='awq')
axes[0, 1].plot(qeft_7b_bits, qeft_7b_c4, label='qeft')
axes[0, 1].set_title('Llama 2 7B C4')
axes[0, 1].set_xlabel('Bits')
axes[0, 1].set_ylabel('Perplexity')
axes[0, 1].grid(c='0.8')
axes[0, 1].legend(loc='upper right')
# axes[0, 1].set_yscale('log')

axes[0, 2].plot(awq_7b_bits, awq_7b_acc, label='awq')
axes[0, 2].plot(qeft_7b_bits, qeft_7b_acc, label='qeft')
axes[0, 2].set_title('Llama 2 7B 6 tasks 0-shot Avg')
axes[0, 2].set_xlabel('Bits')
axes[0, 2].set_ylabel('Acc.')
axes[0, 2].grid(c='0.8')
axes[0, 2].legend(loc='lower right')

axes[1, 0].plot(awq_13b_bits, awq_13b_w2, label='awq')
axes[1, 0].plot(qeft_13b_bits, qeft_13b_w2, label='qeft')
axes[1, 0].set_title('Llama 2 13B Wikitext')
axes[1, 0].set_xlabel('Bits')
axes[1, 0].set_ylabel('Perplexity')
axes[1, 0].grid(c='0.8')
axes[1, 0].legend(loc='upper right')
# axes[1, 0].set_yscale('log')

axes[1, 1].plot(awq_13b_bits, awq_13b_c4, label='awq')
axes[1, 1].plot(qeft_13b_bits, qeft_13b_c4, label='qeft')
axes[1, 1].set_title('Llama 2 13B C4')
axes[1, 1].set_xlabel('Bits')
axes[1, 1].set_ylabel('Perplexity')
axes[1, 1].grid(c='0.8')
axes[1, 1].legend(loc='upper right')
# axes[1, 1].set_yscale('log')

axes[1, 2].plot(awq_13b_bits, awq_13b_acc, label='awq')
axes[1, 2].plot(qeft_13b_bits, qeft_13b_acc, label='qeft')
axes[1, 2].set_title('Llama 2 13B 6 tasks 0-shot Avg')
axes[1, 2].set_xlabel('Bits')
axes[1, 2].set_ylabel('Acc.')
axes[1, 2].grid(c='0.8')
axes[1, 2].legend(loc='lower right')

axes[2, 0].plot(awq_70b_bits, awq_70b_w2, label='awq')
axes[2, 0].plot(qeft_70b_bits, qeft_70b_w2, label='qeft')
axes[2, 0].set_title('Llama 2 70B Wikitext')
axes[2, 0].set_xlabel('Bits')
axes[2, 0].set_ylabel('Perplexity')
axes[2, 0].grid(c='0.8')
axes[2, 0].legend(loc='upper right')
# axes[2, 0].set_yscale('log')

axes[2, 1].plot(awq_70b_bits, awq_70b_c4, label='awq')
axes[2, 1].plot(qeft_70b_bits, qeft_70b_c4, label='qeft')
axes[2, 1].set_title('Llama 2 70B C4')
axes[2, 1].set_xlabel('Bits')
axes[2, 1].set_ylabel('Perplexity')
axes[2, 1].grid(c='0.8')
axes[2, 1].legend(loc='upper right')
# axes[2, 1].set_yscale('log')

axes[2, 2].plot(awq_70b_bits, awq_70b_acc, label='awq')
axes[2, 2].plot(qeft_70b_bits, qeft_70b_acc, label='qeft')
axes[2, 2].set_title('Llama 2 70B 6 tasks 0-shot Avg')
axes[2, 2].set_xlabel('Bits')
axes[2, 2].set_ylabel('Acc.')
axes[2, 2].grid(c='0.8')
axes[2, 2].legend(loc='lower right')


fig.tight_layout() 
plt.savefig(fig_path, dpi=300)



