import matplotlib.pyplot as plt

fig_path='fig/quant/mixed_results.png'

pbllm_7b_w2_ppl = [37.424191, 24.530106, 15.213892, 11.599681, 9.181018, 7.895278, 7.09116, 6.667174]
pbllm_7b_c4_ppl = [46.541725, 32.053589, 20.006735, 14.805572, 12.173552, 10.400482, 9.421015, 8.81493]
pbllm_7b_acc = [0.37945437, 0.409568405, 0.478479808, 0.535805212, 0.584682284, 0.614996345, 0.630383048, 0.647474656]
pbllm_7b_bits = [2.001, 2.253, 2.498, 2.75, 3.002, 3.247, 3.499, 3.751]

pbllm_13b_w2_ppl = [70.201988, 32.704044, 15.748631, 9.572448, 7.770907, 6.786724, 6.197367, 5.860512]
pbllm_13b_c4_ppl = [76.811501, 42.495216, 21.833565, 13.296763, 10.783956, 9.440514, 8.523313, 8.036517]
pbllm_13b_acc = [0.383444576, 0.433793099, 0.557136782, 0.615531694, 0.648068731, 0.662946113, 0.684213227, 0.69237533]
pbllm_13b_bits = [2.001, 2.253, 2.498, 2.75, 3.002, 3.247, 3.499, 3.751]

owq_7b_w2_ppl = [9.512156487, 9.513555527, 9.25275135, 9.089015007, 6.015853405, 5.974658489, 5.961352825, 5.967914104]
owq_7b_c4_ppl = [11.93916416, 11.70453358, 11.55443287, 11.22610092, 7.941548347, 7.913356781, 7.89141798, 7.887867451]
owq_7b_acc = [0.582101676, 0.595192291, 0.593095279, 0.600576176, 0.676021183, 0.675676441, 0.676013533, 0.674066416]
owq_7b_bits = [2.2, 2.4, 2.6, 2.8, 3.2, 3.4, 3.6, 3.8]

owq_13b_w2_ppl = [8.141159058, 7.90238905, 7.906852245, 7.644672871, 5.259451866, 5.233787537, 5.246657372, 5.222622395]
owq_13b_c4_ppl = [10.81324387, 10.55164051, 10.35543156, 10.24857807, 7.184574127, 7.174242496, 7.165292263, 7.144797802]
owq_13b_acc = [0.622793093, 0.621861314, 0.625522131, 0.636278665, 0.698394859, 0.701621779, 0.706704045, 0.70392782]
owq_13b_bits = [2.2, 2.4, 2.6, 2.8, 3.2, 3.4, 3.6, 3.8]

our_7b_w2_ppl = [11.19106102, 9.764636993, 8.872149467, 8.325058937, 7.870931625, 7.518453598, 7.079739571, 6.725832939, 6.434355736, 6.229644299, 6.079787731, 6.006623268, 5.909396172, 5.870795727, 5.800350666, 5.762818336, 5.718862534, 5.67137146, 5.641074181]
our_7b_c4_ppl = [14.59436512, 12.72353172, 11.50012684, 10.74845028, 10.24339867, 9.805372238, 9.254193306, 8.807351112, 8.498590469, 8.278894424, 8.098436356, 7.960915089, 7.846197605, 7.802731514, 7.719016552, 7.62433672, 7.570459843, 7.524265289, 7.471936226]
our_7b_acc = [0.583398156, 0.603505925, 0.617655567, 0.62730272, 0.641849032, 0.643505389, 0.653186712, 0.663045316, 0.660668257, 0.668562713, 0.670189802, 0.671585229, 0.676409125, 0.678162857, 0.679179119, 0.678109589, 0.675713325, 0.680518431, 0.682726081]
our_7b_bits = [2.104760363, 2.202882124, 2.301975389, 2.403659326, 2.503562176, 2.603465026, 2.704177461, 2.804727979, 2.898477979, 3.004209845, 3.102331606, 3.200291451, 3.301813472, 3.397506477, 3.495466321, 3.604112694, 3.699643782, 3.803756477, 3.903659326]

our_13b_w2_ppl = [7.947050571, 7.196350098, 6.771688938, 6.475214481, 6.283269882, 5.991836071, 5.813879013, 5.615925789, 5.480833054, 5.346190453, 5.280626297, 5.224911213, 5.19360733, 5.158073425, 5.134021282, 5.089065552, 5.046744347, 5.027336121, 4.99258709]
our_13b_c4_ppl = [10.8230648, 9.740745544, 9.210697174, 8.818965912, 8.553098679, 8.190875053, 7.965988159, 7.680941582, 7.458914757, 7.327080727, 7.228187084, 7.161309242, 7.097438335, 7.04694891, 7.006668091, 6.959143162, 6.917842865, 6.894935608, 6.854963779]
our_13b_acc = [0.620162714, 0.641568099, 0.652289247, 0.667989109, 0.670153152, 0.681793414, 0.683563471, 0.691799782, 0.697571256, 0.708416954, 0.708778399, 0.706884761, 0.708478182, 0.712676784, 0.709836967, 0.711591271, 0.713002553, 0.713735525, 0.71590639]
our_13b_bits = [2.10392562, 2.20392562, 2.304752066, 2.404338843, 2.503305785, 2.604752066, 2.704132231, 2.804752066, 2.904752066, 3.00268595, 3.104752066, 3.202479339, 3.296487603, 3.395867769, 3.501033058, 3.601652893, 3.703719008, 3.804958678, 3.9]

fig, axes = plt.subplots(nrows=2, ncols=3, figsize=(15, 10)) 
fig.subplots_adjust(hspace=0.5, wspace=0.1)

axes[0, 0].plot(pbllm_7b_bits, pbllm_7b_w2_ppl, label='pb-llm')
axes[0, 0].plot(owq_7b_bits, owq_7b_w2_ppl, label='owq')
axes[0, 0].plot(our_7b_bits, our_7b_w2_ppl, label='our awq')
axes[0, 0].set_title('Llama 2 7B Wikitext')
axes[0, 0].set_xlabel('Bits')
axes[0, 0].set_ylabel('Perplexity')
axes[0, 0].grid(c='0.8')
axes[0, 0].legend(loc='upper right')
axes[0, 0].set_yscale('log')

axes[0, 1].plot(pbllm_7b_bits, pbllm_7b_c4_ppl, label='pb-llm')
axes[0, 1].plot(owq_7b_bits, owq_7b_c4_ppl, label='owq')
axes[0, 1].plot(our_7b_bits, our_7b_c4_ppl, label='our awq')
axes[0, 1].set_title('Llama 2 7B C4')
axes[0, 1].set_xlabel('Bits')
axes[0, 1].set_ylabel('Perplexity')
axes[0, 1].grid(c='0.8')
axes[0, 1].legend(loc='upper right')
axes[0, 1].set_yscale('log')

axes[0, 2].plot(pbllm_7b_bits, pbllm_7b_acc, label='pb-llm')
axes[0, 2].plot(owq_7b_bits, owq_7b_acc, label='owq')
axes[0, 2].plot(our_7b_bits, our_7b_acc, label='our awq')
axes[0, 2].set_title('Llama 2 7B 0-shot Avg')
axes[0, 2].set_xlabel('Bits')
axes[0, 2].set_ylabel('Acc.')
axes[0, 2].grid(c='0.8')
axes[0, 2].legend(loc='lower right')

axes[1, 0].plot(pbllm_13b_bits, pbllm_13b_w2_ppl, label='pb-llm')
axes[1, 0].plot(owq_13b_bits, owq_13b_w2_ppl, label='owq')
axes[1, 0].plot(our_13b_bits, our_13b_w2_ppl, label='our awq')
axes[1, 0].set_title('Llama 2 13B Wikitext')
axes[1, 0].set_xlabel('Bits')
axes[1, 0].set_ylabel('Perplexity')
axes[1, 0].grid(c='0.8')
axes[1, 0].legend(loc='upper right')
axes[1, 0].set_yscale('log')

axes[1, 1].plot(pbllm_13b_bits, pbllm_13b_c4_ppl, label='pb-llm')
axes[1, 1].plot(owq_13b_bits, owq_13b_c4_ppl, label='owq')
axes[1, 1].plot(our_13b_bits, our_13b_c4_ppl, label='our awq')
axes[1, 1].set_title('Llama 2 13B C4')
axes[1, 1].set_xlabel('Bits')
axes[1, 1].set_ylabel('Perplexity')
axes[1, 1].grid(c='0.8')
axes[1, 1].legend(loc='upper right')
axes[1, 1].set_yscale('log')

axes[1, 2].plot(pbllm_13b_bits, pbllm_13b_acc, label='pb-llm')
axes[1, 2].plot(owq_13b_bits, owq_13b_acc, label='owq')
axes[1, 2].plot(our_13b_bits, our_13b_acc, label='our awq')
axes[1, 2].set_title('Llama 2 13B 0-shot Avg')
axes[1, 2].set_xlabel('Bits')
axes[1, 2].set_ylabel('Acc.')
axes[1, 2].grid(c='0.8')
axes[1, 2].legend(loc='lower right')


fig.tight_layout() 
plt.savefig(fig_path, dpi=300)



