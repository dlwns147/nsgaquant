import matplotlib.pyplot as plt

fig, axes = plt.subplots(nrows=1, ncols=2, figsize=(10, 5)) 
fig.subplots_adjust(hspace=0.5, wspace=0.1)

fig_path = 'vis/fig/quant/qeft_target_rank.png'

qeft_7b_w2 = [[9.230200768, 6.874115467, 6.169258118, 5.949491024, 5.686436176],
            # [8.788499832, 6.901405811, 6.376855373, 6.098805904, 5.782333851],
            #   [8.410950661, 6.82205534, 6.205398083, 6.01082325, 5.75983572],
            #   [8.451860428, 6.729536057, 6.261720181, 6.048526287, 5.720083714],
            #   [8.161359787, 6.596245289, 6.209739208, 5.983379841, 5.724930763],
              [8.28944397, 6.587744236, 6.145029068, 5.969410896, 5.692835331],
              [8.361685753, 6.690117836, 6.134120941, 5.937380314, 5.703665733],
              [8.899485588, 6.714141369, 6.175282955, 5.940193653, 5.714680672],
            #   [float('nan'), 7.082639694, 6.493015766, 6.061424732, 5.754510403]]
]

qeft_7b_acc = [[0.558844071, 0.603762387, 0.623178267, 0.629243847, 0.637895918],
            #     [0.575767164 , 0.608885151 , 0.614821786 , 0.628273662 , 0.638075191],
            #    [0.585095565 , 0.616708921 , 0.622800105 , 0.635277955 , 0.639409927],
            #    [0.575273206 , 0.610825074 , 0.623521398 , 0.631956608 , 0.64184157],
            #    [0.588050125 , 0.614714746 , 0.629753048 , 0.632569652 , 0.64021167],
               [0.589623895 , 0.616605233 , 0.629800246 , 0.633478535 , 0.639351747],
               [0.589290689 , 0.619618299 , 0.624149695 , 0.63362082 , 0.640669284],
               [0.586973345 , 0.62312202 , 0.6349534 , 0.63947817 , 0.64692586],
            #    [float('nan'),0.615127312 , 0.632824635 , 0.638413918 , 0.641832737]
]

qeft_7b_bits = [[2.5, 3.0, 3.25, 3.5, 4.0]] * len(qeft_7b_w2)
# qeft_7b_label = list(map(str, [0, 1, 2, 4, 8, 16, 32, 64, 128]))
qeft_7b_label = list(map(str, [0, 16, 32, 64]))


qeft_13b_w2 = [[6.912684441, 5.709173203, 5.382876873, 5.225251675, 5.048958302],
#     [7.172757626, 5.852172852, 5.421903133, 5.275883675, 5.110809803],
# [6.970269203, 5.853452682, 5.389793396, 5.282066822, 5.090429783],
# [6.890817642, 5.779466152, 5.396733761, 5.283398628, 5.152750969],
# [6.936172485, 5.77220726, 5.421701908, 5.290072441, 5.068252563],
[6.785279751, 5.674370766, 5.371716499, 5.240821362, 5.075881958],
[6.987552643, 5.791992188, 5.359017372, 5.239430428, 5.043478489],
[7.08817625, 5.822164536, 5.403530598, 5.253098011, 5.05128479],
# [float('nan'), 6.028294086, 5.554752827, 5.294374466, 5.08007288]
]

qeft_13b_acc = [[0.618238785, 0.656759506, 0.661456714, 0.66566668, 0.670725684],
    # [0.61479516, 0.655019881, 0.662848274, 0.661737074, 0.667030785],
    #             [0.625809854, 0.64808654, 0.658702836, 0.663501851, 0.673068618],
    #             [0.624949616, 0.651529813, 0.657961594, 0.663296605, 0.671483727],
    #             [0.624633905, 0.651913006, 0.663664412, 0.666609299, 0.670667251],
                [0.624500999, 0.662246683, 0.664294186, 0.664751851, 0.669987801],
                [0.628846669, 0.658666512, 0.660549501, 0.671282385, 0.672772182],
                [0.621222603, 0.655073336, 0.664363507, 0.667216517, 0.674695009],
                # [float('nan'), 0.649344544, 0.659318118, 0.662987172, 0.670345319],
        ]

qeft_13b_bits = [[2.5, 3.0, 3.25, 3.5, 4.0]] * len(qeft_13b_w2)
# qeft_13b_label = list(map(str, [0, 1, 2, 4, 8, 16, 32, 64, 128]))
qeft_13b_label = list(map(str, [0, 16, 32, 64]))

# axes[0, 0].plot(qeft_13b_bits, qeft_13b_w2, label=qeft_13b_label)
# axes[0, 0].plot(qeft_13b_bits, qeft_13b_acc)
# axes[0, 0].set_title('Llama 2 7B Wikitext')
# axes[0, 0].set_xlabel('Bits')
# axes[0, 0].set_ylabel('Perplexity')
# axes[0, 0].grid(c='0.8')
# axes[0, 0].legend(loc='upper right')
# axes[0, 0].set_yscale('log')

ax2 = axes[0].twinx()
for i in range(len(qeft_7b_label)):
    axes[0].plot(qeft_7b_bits[i], qeft_7b_w2[i], label=qeft_7b_label[i])
    ax2.plot(qeft_7b_bits[i], qeft_7b_acc[i], linestyle='dashed', label=qeft_7b_label[i])

axes[0].set_title('Llama 2 7B')
axes[0].set_xlabel('Bits')
axes[0].set_ylabel('Perplexity')
axes[0].grid(c='0.8')
axes[0].legend(loc='upper right')
ax2.set_ylabel('Avg. Acc.')
ax2.grid(c='0.8')

ax2 = axes[1].twinx()
for i in range(len(qeft_13b_label)):
    axes[1].plot(qeft_13b_bits[i], qeft_13b_w2[i], label=qeft_13b_label[i])
    ax2.plot(qeft_13b_bits[i], qeft_13b_acc[i], linestyle='dashed', label=qeft_13b_label[i])
# axes[1].plot(qeft_13b_bits, qeft_13b_w2, label=qeft_13b_label)
# axes[1].plot(qeft_13b_bits, qeft_13b_acc, label=qeft_13b_label)
axes[1].set_title('Llama 2 13B')
axes[1].set_xlabel('Bits')
axes[1].set_ylabel('Perplexity')
axes[1].grid(c='0.8')
axes[1].legend(loc='upper right')
ax2.set_ylabel('Avg. Acc.')
ax2.grid(c='0.8')
# axes[1].set_yscale('log')



fig.tight_layout() 
plt.savefig(fig_path, dpi=300)
